module ECF8F24(
    input  wire sysclk,    // 12 MHz system clock
    input  wire MCLR,      
    output wire DLG_LED,   // Debug LED output (1Hz clock)
    // Control inputs/outputs
    inout  wire PRTA1,     // StoreTCON
    inout  wire PRTA2,     // TF_RST (not used in this test)
    inout  wire PRTA3,     // StoreTH and StoreTL (both connected)
    inout  wire PRTA4,     // TF_CLR
    inout  wire PRTA5,     // Equal (debug)
    output wire PRTA6,     // TChannel
    output wire PRTA7,     // Fset (debug)
    output wire PRTA8,     // TFlag
    inout  wire PRTB1,     // Enable (now from TCON register)
    inout  wire PRTB2,     
    inout  wire PRTB3,     
    inout  wire PRTB4,     
    inout  wire PRTB5,     
    inout  wire PRTB6,     
    inout  wire PRTB7,     
    inout  wire PRTB8,     
    // Data inputs (Data bus)
    input  wire D1,        
    input  wire D2,        
    input  wire D3,        
    input  wire D4,        
    input  wire D5,        
    input  wire D6,        
    input  wire D7,       
    input  wire D8,    
    
    output wire Add1, 
    output wire Add2, 
    output wire Add3, 
    output wire Add4,
    output wire Add5, 
    output wire Add6, 
    output wire Add7, 
    output wire Add8,   
    
    input wire RxPin,
    output wire TxPin,
    
    output wire TCA
    
);
    wire RedCLK;
    
    ClockDivider clk_div (
        .clk_in(sysclk),
        .clk_out(RedCLK)
    );
    
    
    // Connect 1Hz clock to debug LED
    assign DLG_LED = RedCLK;
   
//    wire [7:0] DataBus = {D8, D7, D6, D5, D4, D3, D2, D1};  // MSB to LSB
    wire [7:0] PRTPins = {PRTA8, PRTA7, PRTA6, PRTA5, PRTA4, PRTA3, PRTA2, PRTA1};  // MSB to LSB
//    wire [7:0] RXBuf = {PRTB8, PRTB7, PRTB6, PRTB5, PRTB4, PRTB3, PRTB2, PRTB1};  // MSB to LSB
wire [7:0] TC;
    assign {Add8, Add7, Add6, Add5, Add4, Add3, Add2, Add1} = TC;


assign StoreBR = PRTA1;
assign StoreBPS = PRTA1;
assign Databus = 8'd9;
assign CLK_Sel = 1'd0;
assign EN_RX = 1'd1;
assign EN_RXINT = 1'd1;

assign CLRF = PRTA2;
assign CLR = MCLR;


assign TCA = BCLK;
wire [3:0] RXC;
wire [3:0] RXCn;


assign PRTA8 = RXC[3];
assign PRTA7 = RXC[2];
assign PRTA6 = RXC[1];
assign PRTA5 = RXC[0];
assign PRTB4 = RXCn[3];
assign PRTB3 = RXCn[2];
assign PRTB2 = RXCn[1];
assign PRTB1 = RXCn[0];

 BaudrateGenerator BaudGen (
    // System signals
    .SYSCLK(sysclk),          // System clock
    
    .CLK_IN(RedCLK),          // Input clock
    .CLK_Sel(CLK_Sel),
    
    .Enable(EN_BAUD),
    .D(Databus),         // 8-bit data input bus
    .StoreBR(StoreBR),       // Store signal for TReg register
    .StoreBPS(StoreBPS),        // Store signal for prescaler register
    .CLR(UART_CLR),             // Clear signal
 
    .BaudCLK(BCLK),
    .BaudCLKn(BCLK_n)
);



 Counter4bit RXCounter(
    .INC(RXINC),                // Clock input
    .TC_RST(RXC_RST),             // Asynchronous reset (active-high)
    .TC(RXC),            // 4-bit counter output
    .TCn(RXCn)            
);

assign PRTA4 = RXC_RST;

SIPO RXBUF(
    .D(RxPin),          // Serial data input
    .CLK(RXCLK),        // Clock input
    .CLR(UART_CLR),        // Clear/Reset input (active-high)
    .RegOut() // 8-bit parallel output
);


 RxCTRL Rxcontroller(  
    .SYSCLK(sysclk),
   
    .RXINC(RXINC),          
    .RXC_RST(RXC_RST),        
    .RXC(RXC),      
    .RXCn(RXCn),      
     
    .EN_RX(EN_RX),           
    .EN_RXINT(EN_RXINT),        
    
    .BCLK(BCLK),
    .BCLK_n(BCLK_n),
    
    .CLRF(CLRF),            
    .CLR(CLR),            
    .MCLR(MCLR),            
       
    .EN_BAUD(EN_BAUD),        
    .INTVector(),      
    .RX_Flag(),        
     
    .Rx(RxPin),              
    
    .RXCLK(RXCLK),          
    .UART_CLR(UART_CLR)              
        
);


endmodule